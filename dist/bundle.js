(()=>{"use strict";class t{constructor(){this.grid=this.create(),this.ships=[],this.gameOver=!1,this.missedShots=[]}add(t){this.ships.push(t);for(const e of t.coords)this.grid[e[0]][e[1]]="O"}receiveAttack(t){if("O"===this.grid[t[0]][t[1]]){this.grid[t[0]][t[1]]="X";for(const e of this.ships)for(const r of e.coords)r.every((function(e,r){return e===t[r]}))&&(e.hit(),this.checkGameOver())}else this.missedShots.push(t),this.grid[t[0]][t[1]]="-"}checkGameOver(){let t=0;for(const e of this.ships)e.hitCount===e.length&&(t+=1);t===this.ships.length?this.gameOver=!0:this.gameOver=!1}create(){const t=[];for(let e=0;e<10;e++){let e=[];for(let t=0;t<10;t++)e.push(".");t.push(e)}return t}isValidMove(t){return"X"!==this.grid[t[0]][t[1]]&&!this.missedShots.includes(t)&&"-"!==this.grid[t[0]][t[1]]}}class e{#t={carrier:5,battleship:4,destroyer:3,submarine:3,patrol:2};constructor(t,e,r){this.length=this.#t[t],this.hitCount=0,this.sunkStatus=!1,this.coords=[e],this.populateCoords(r)}hit(){this.hitCount+=1,this.hitCount===this.length&&(this.sunkStatus=!0)}isSunk(){return this.sunkStatus}populateCoords(t){if(this.length<2)return;const e=[[0,1],[1,0]][!0===t?0:1];let r=this.coords[0][0],s=this.coords[0][1];for(let t=0;t<this.length-1;t++){let t=r+e[0],o=s+e[1];this.coords.push([t,o]),r=t,s=o}}}class r{constructor(e,r){this.name=e,this.board=new t,this.index=r}generateRandomAttack(t){let e=Math.floor(10*Math.random()+0),r=Math.floor(10*Math.random()+0);for(;!t.board.isValidMove([e,r]);)e=Math.floor(10*Math.random()+0),r=Math.floor(10*Math.random()+0);return[e,r]}move(t,e){e.board.receiveAttack(t)}setShip(t,r,s){const o=new e(t,r,s);this.board.add(o)}}const s=(()=>{let t=new r("Player 1",0),e=new r("Player 2",1);const s=document.querySelectorAll(".gameboard-cell"),a=document.querySelectorAll(".opponent-gameboard-cell"),n=document.querySelector(".game-text"),i=document.querySelector(".start-btn"),c=(document.querySelector(".rotate-btn"),document.querySelector(".restart-btn"));document.querySelector(".ships-container");let d=!1,l=t;function h(){const r=[parseInt(this.getAttribute("data-x")),parseInt(this.getAttribute("data-y"))],s=l===t?e:t;s.board.isValidMove(r)&&(l.move(r,s),o.renderDOMGrid(s),u(l,s))}const u=(r,i)=>{!0===i.board.gameOver?(d=!1,n.textContent=`${r.name} wins the game!`,s.forEach((t=>{t.removeEventListener("click",h)})),a.forEach((t=>{t.removeEventListener("click",h)}))):(l=l===t?e:t,"Player 2"===i.name&&(()=>{const r=e.generateRandomAttack(t);e.move(r,t),o.renderDOMGrid(t),u(e,t)})())};return i.addEventListener("click",(t=>{t.preventDefault(),(()=>{d=!0,n.textContent="Game started! Sink all the opponent's ships.";const t={carrier:5,battleship:4,destroyer:3,submarine:3,patrol:2},r=["carrier","battleship","destroyer","submarine","patrol"],s=[!0,!1];let o=0;for(;o<r.length;){const a=s[parseInt(Math.floor(2*Math.random()+0))],n=parseInt(Math.floor(10*Math.random()+0)),i=parseInt(Math.floor(10*Math.random()+0));if(!0===a){if(i+t[r[o]]<9)continue;let s=!1;for(let a=0;a<t[r[o]];a++)e.board.grid[n][i+a]&&"O"!==e.board.grid[n][i+a]||(s=!0);if(s)continue}else{if(n+t[r[o]]>9)continue;let s=!1;for(let a=0;a<t[r[o]];a++)e.board.grid[n+a][i]&&"O"!==e.board.grid[n+a][i]||(s=!0);if(s)continue}e.setShip(r[o],[n,i],a),o++}a.forEach((t=>{t.addEventListener("click",h)}))})(),c.classList.toggle("hidden"),i.classList.toggle("hidden")})),c.addEventListener("click",(function(){location.reload()})),{getCurrPlayer:()=>l}})(),o=(()=>{let t=!0;const e=document.querySelector(".rotate-btn");let r;function o(){r=this}function a(t){t.preventDefault()}function n(t){t.preventDefault()}function i(){}function c(){}function d(){const o=r.classList[1],a={carrier:5,battleship:4,destroyer:3,submarine:3,patrol:2}[o],n=[parseInt(this.dataset.x),parseInt(this.dataset.y)];if(t){if(!(n[1]+(a-1)<=9))return;for(let t=0;t<a;t++)document.querySelector(`[data-coord='[${n[0]},${n[1]+t}]']`).classList.add("ship");r.remove()}else{if(!(n[0]+(a-1)<=9))return;for(let t=0;t<a;t++)document.querySelector(`[data-coord='[${n[0]+t},${n[1]}]']`).classList.add("ship");r.remove()}s.getCurrPlayer().setShip(o,n,t),l()&&(document.querySelector(".start-btn").classList.toggle("hidden"),e.classList.toggle("hidden"))}e.addEventListener("click",(e=>{e.preventDefault(),document.querySelectorAll(".ships-container .ship").forEach((t=>{const e=t.className.split(" ")[1];t.classList.toggle(`${e}-vertical`)})),t=!1===t})),document.querySelectorAll(".ship").forEach((t=>t.addEventListener("dragstart",o)));const l=()=>0===document.querySelectorAll(".ships-container .ship").length,h=document.querySelectorAll(".user-board .gameboard .gameboard-row .gameboard-cell");return h.forEach((t=>t.addEventListener("dragstart",o))),h.forEach((t=>t.addEventListener("dragover",a))),h.forEach((t=>t.addEventListener("dragenter",n))),h.forEach((t=>t.addEventListener("dragleave",i))),h.forEach((t=>t.addEventListener("drop",d))),h.forEach((t=>t.addEventListener("dragend",c))),{renderDOMGrid:t=>{const e=t.board.grid,r="Player 1"===t.name?0:1,s=t.board.missedShots;for(let t=0;t<10;t++)for(let s=0;s<10;s++){const o=document.querySelectorAll(`[data-coord='[${t},${s}]']`);"X"===e[t][s]&&o[r].classList.add("good-attack")}for(const t of s){const[e,s]=t;document.querySelectorAll(`[data-coord='[${e},${s}]']`)[r].classList.add("missed-attack")}},resetDOMGrid:()=>{h.forEach((t=>{t.classList.remove("ship"),t.classList.remove("missed-attack"),t.classList.remove("good-attack")}))}}})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLOEYsRUFDRjdELFNBQVNDLGlCQUFpQixpQkFBaUJwQyxLQUFLRSxRQUN4RDZGLEdBQWE1QixVQUFVbkYsSUFBSSxnQkFDcEMsR0FZb0JpSCxhQVJILEtBQ2pCTixFQUFZdEMsU0FBUUMsSUFDaEJBLEVBQUthLFVBQVVtQixPQUFPLFFBQ3RCaEMsRUFBS2EsVUFBVW1CLE9BQU8saUJBQ3RCaEMsRUFBS2EsVUFBVW1CLE9BQU8sY0FBYyxHQUN2QyxFQUlSLEVBeklXLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL0dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy9QbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEdhbWVib2FyZCB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmdyaWQgPSB0aGlzLmNyZWF0ZSgpOyBcclxuICAgICAgICB0aGlzLnNoaXBzID0gW107IFxyXG4gICAgICAgIHRoaXMuZ2FtZU92ZXIgPSBmYWxzZTsgXHJcbiAgICAgICAgdGhpcy5taXNzZWRTaG90cyA9IFtdO1xyXG4gICAgfVxyXG4gICAgYWRkKHNoaXApIHtcclxuICAgICAgICB0aGlzLnNoaXBzLnB1c2goc2hpcCk7IFxyXG4gICAgICAgIGZvciAoY29uc3QgY29vcmQgb2Ygc2hpcC5jb29yZHMpIHtcclxuICAgICAgICAgICAgdGhpcy5ncmlkW2Nvb3JkWzBdXVtjb29yZFsxXV0gPSBcIk9cIjsgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmVjZWl2ZUF0dGFjayhjb29yZCkge1xyXG4gICAgICAgIC8vIEluaXRpYWxseSBjaGVjayBpZiB0aGUgZ3JpZCBjZWxsIGlzIG9jY3VwaWVkIGJ5IGEgc2hpcC4gRXZlcnkgY2VsbCBvY2N1cGllZCBieSBhIHNoaXAgd2lsbCBoYXZlIHRoZSB2YWx1ZSBcIk9cIi5cclxuICAgICAgICBpZiAodGhpcy5ncmlkW2Nvb3JkWzBdXVtjb29yZFsxXV0gPT09IFwiT1wiKSB7XHJcbiAgICAgICAgICAgIC8vIENoYW5nZSB0aGUgbWFya2luZyBvZiB0aGUgZ3JpZCBjZWxsIHRvIFwiWFwiIHRvIG1hcmsgdGhhdCBpdCdzIGJlZW4gaGl0IGJ5IGFuIGF0dGFjay4gXHJcbiAgICAgICAgICAgIHRoaXMuZ3JpZFtjb29yZFswXV1bY29vcmRbMV1dID0gXCJYXCI7IFxyXG4gICAgICAgICAgICAvLyBJZiBvY2N1cGllZCBieSBhIHNoaXAsIGZpbmQgdGhlIHNwZWNpZmljIFNoaXAgb2JqZWN0IHRoYXQgaXMgb2NjdXB5aW5nIHRoZSBjZWxsLCBpbmNyZW1lbnQgaXQncyBoaXQgY291bnQsIFxyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgZ2FtZSBpcyBvdmVyLlxyXG4gICAgICAgICAgICBmb3IgKGNvbnN0IHNoaXAgb2YgdGhpcy5zaGlwcykge1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBjb29yZGluYXRlIG9mIHNoaXAuY29vcmRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvb3JkaW5hdGUuZXZlcnkoZnVuY3Rpb24oZWxlbWVudCwgaW5kZXgpIHtyZXR1cm4gZWxlbWVudCA9PT0gY29vcmRbaW5kZXhdfSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hpcC5oaXQoKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tHYW1lT3ZlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBPdGhlcndpc2UsIGFkZCB0aGUgYXR0YWNrIHRvIG1pc3NlZFNob3RzXHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMubWlzc2VkU2hvdHMucHVzaChjb29yZCk7IFxyXG4gICAgICAgICAgICB0aGlzLmdyaWRbY29vcmRbMF1dW2Nvb3JkWzFdXSA9IFwiLVwiO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNoZWNrR2FtZU92ZXIoKSB7XHJcbiAgICAgICAgbGV0IHN1bmtDb3VudCA9IDA7IFxyXG4gICAgICAgIGZvciAoY29uc3Qgc2hpcCBvZiB0aGlzLnNoaXBzKSB7XHJcbiAgICAgICAgICAgIGlmIChzaGlwLmhpdENvdW50ID09PSBzaGlwLmxlbmd0aCkgc3Vua0NvdW50ICs9IDE7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc3Vua0NvdW50ID09PSB0aGlzLnNoaXBzLmxlbmd0aCA/IHRoaXMuZ2FtZU92ZXIgPSB0cnVlIDogdGhpcy5nYW1lT3ZlciA9IGZhbHNlOyBcclxuICAgIH1cclxuICAgIGNyZWF0ZSgpIHtcclxuICAgICAgICBjb25zdCBib2FyZCA9IFtdOyBcclxuICAgICAgICBmb3IobGV0IHIgPSAwOyByIDwgMTA7IHIrKykge1xyXG4gICAgICAgICAgICBsZXQgcm93ID0gW107IFxyXG4gICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IDEwOyBjKyspIHtcclxuICAgICAgICAgICAgICAgIHJvdy5wdXNoKCcuJyk7IFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJvYXJkLnB1c2gocm93KTsgXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBib2FyZDsgXHJcbiAgICB9XHJcbiAgICBpc1ZhbGlkTW92ZShjb29yZHMpIHtcclxuICAgICAgICBpZiAodGhpcy5ncmlkW2Nvb3Jkc1swXV1bY29vcmRzWzFdXSA9PT0gXCJYXCIgfHwgdGhpcy5taXNzZWRTaG90cy5pbmNsdWRlcyhjb29yZHMpIHx8IHRoaXMuZ3JpZFtjb29yZHNbMF1dW2Nvb3Jkc1sxXV0gPT09IFwiLVwiKSBcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyBcclxuICAgICAgICBlbHNlICAgXHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlOyBcclxuICAgIH1cclxufTsgXHJcblxyXG5leHBvcnQgeyBHYW1lYm9hcmQgfTsiLCJjbGFzcyBTaGlwIHtcclxuXHJcbiAgICAjc2hpcFR5cGVzID0ge1xyXG4gICAgICAgICdjYXJyaWVyJzogNSwgXHJcbiAgICAgICAgJ2JhdHRsZXNoaXAnOiA0LCBcclxuICAgICAgICAnZGVzdHJveWVyJzogMywgXHJcbiAgICAgICAgJ3N1Ym1hcmluZSc6IDMsIFxyXG4gICAgICAgICdwYXRyb2wnOiAyXHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHR5cGUsIHN0YXJ0Q29vcmQsIGlzSG9yaXpvbnRhbCkge1xyXG4gICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy4jc2hpcFR5cGVzW3R5cGVdOyBcclxuICAgICAgICB0aGlzLmhpdENvdW50ID0gMDsgXHJcbiAgICAgICAgdGhpcy5zdW5rU3RhdHVzID0gZmFsc2U7IFxyXG4gICAgICAgIHRoaXMuY29vcmRzID0gW3N0YXJ0Q29vcmRdO1xyXG4gICAgICAgIHRoaXMucG9wdWxhdGVDb29yZHMoaXNIb3Jpem9udGFsKTtcclxuICAgIH1cclxuXHJcbiAgICBoaXQoKSB7XHJcbiAgICAgICAgdGhpcy5oaXRDb3VudCArPSAxO1xyXG4gICAgICAgIGlmICh0aGlzLmhpdENvdW50ID09PSB0aGlzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnN1bmtTdGF0dXMgPSB0cnVlOyBcclxuICAgICAgICB9OyBcclxuICAgIH1cclxuXHJcbiAgICBpc1N1bmsoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3Vua1N0YXR1czsgXHJcbiAgICB9XHJcblxyXG4gICAgcG9wdWxhdGVDb29yZHMoaXNIb3Jpem9udGFsKSB7XHJcbiAgICAgICAgLy8gSWYgdGhlIGxlbmd0aCBvZiB0aGUgc2hpcCBpcyAxLCBpdCBvY2N1cGllcyBvbmx5IG9uZSBjZWxsLiBUaGUgc3RhcnRpbmcgY29vcmRpbmF0ZSBpcyB0aGUgc2hpcCdzIG9ubHkgY29vcmRpbmF0ZS4gXHJcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoIDwgMikgcmV0dXJuOyBcclxuXHJcbiAgICAgICAgY29uc3Qgb2Zmc2V0SW5kZXggPSBpc0hvcml6b250YWwgPT09IHRydWUgPyAwIDogMTsgXHJcbiAgICAgICAgY29uc3Qgb2Zmc2V0cyA9IFtbMCwgMV0sIFsxLCAwXV07ICBcclxuXHJcbiAgICAgICAgLy8gRGV0ZXJtaW5pbmcgdGhlIHNoaXAncyBvZmZzZXQgZGVwZW5kaW5nIG9uIHRoZSBkaXJlY3Rpb24gc3BlY2lmaWVkLiBcclxuICAgICAgICBjb25zdCBzaGlwT2Zmc2V0ID0gb2Zmc2V0c1tvZmZzZXRJbmRleF07IFxyXG4gICAgICAgIC8vIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gJ3RvcCcpIHNoaXBPZmZzZXQgPSBvZmZzZXRzWzBdOyBcclxuICAgICAgICAvLyBlbHNlIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gJ2xlZnQnKSBzaGlwT2Zmc2V0ID0gb2Zmc2V0c1sxXTsgXHJcbiAgICAgICAgLy8gZWxzZSBpZiAodGhpcy5kaXJlY3Rpb24gPT09ICdyaWdodCcpIHNoaXBPZmZzZXQgPSBvZmZzZXRzWzJdOyBcclxuICAgICAgICAvLyBlbHNlIHNoaXBPZmZzZXQgPSBvZmZzZXRzWzNdOyBcclxuXHJcbiAgICAgICAgLy8gUG9wdWxhdGluZyB0aGUgc2hpcCdzIC5jb29yZHMgYXR0cmlidXRlIHdpdGggdGhlIGNlbGxzIHRoZSBzaGlwIG9jY3VwaWVzLiBcclxuICAgICAgICBsZXQgY3VyWCA9IHRoaXMuY29vcmRzWzBdWzBdOyBcclxuICAgICAgICBsZXQgY3VyWSA9IHRoaXMuY29vcmRzWzBdWzFdOyBcclxuXHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgbmV3WCA9IGN1clggKyBzaGlwT2Zmc2V0WzBdOyBcclxuICAgICAgICAgICAgbGV0IG5ld1kgPSBjdXJZICsgc2hpcE9mZnNldFsxXTtcclxuICAgICAgICAgICAgdGhpcy5jb29yZHMucHVzaChbbmV3WCwgbmV3WV0pOyBcclxuICAgICAgICAgICAgY3VyWCA9IG5ld1g7IFxyXG4gICAgICAgICAgICBjdXJZID0gbmV3WTsgXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59OyBcclxuXHJcbmV4cG9ydCB7IFNoaXAgfTsiLCJpbXBvcnQgeyBHYW1lYm9hcmQgfSBmcm9tICcuLi9mYWN0b3JpZXMvR2FtZWJvYXJkJzsgXHJcbmltcG9ydCB7IFNoaXAgfSBmcm9tICcuLi9mYWN0b3JpZXMvU2hpcCc7XHJcblxyXG5jbGFzcyBQbGF5ZXIge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGluZGV4KSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmJvYXJkID0gbmV3IEdhbWVib2FyZCgpO1xyXG4gICAgICAgIHRoaXMuaW5kZXggPSBpbmRleDsgXHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVSYW5kb21BdHRhY2sob3Bwb25lbnQpIHtcclxuICAgICAgICAvLyBIb3cgdG8gZ2VuZXJhdGUgcmFuZG9tIG51bWJlciBiZXR3ZWVuIGEgc3BlY2lmaWMgcmFuZ2UgKGluY2x1c2l2ZSk6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSArIG1pbilcclxuICAgICAgICBsZXQgcmFuZG9tWCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5IC0gMCArIDEpICsgMCk7IFxyXG4gICAgICAgIGxldCByYW5kb21ZID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDkgLSAwICsgMSkgKyAwKTsgXHJcblxyXG4gICAgICAgIHdoaWxlICghb3Bwb25lbnQuYm9hcmQuaXNWYWxpZE1vdmUoW3JhbmRvbVgsIHJhbmRvbVldKSkge1xyXG4gICAgICAgICAgICByYW5kb21YID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDkgLSAwICsgMSkgKyAwKTtcclxuICAgICAgICAgICAgcmFuZG9tWSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5IC0gMCArIDEpICsgMCk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIFtyYW5kb21YLCByYW5kb21ZXTsgXHJcbiAgICB9XHJcblxyXG4gICAgbW92ZShjb29yZCwgZW5lbXkpIHsgXHJcbiAgICAgICAgZW5lbXkuYm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZCk7IFxyXG4gICAgfVxyXG5cclxuICAgIHNldFNoaXAodHlwZSwgc3RhcnRDb29yZCwgaXNIb3Jpem9udGFsKSB7XHJcbiAgICAgICAgY29uc3QgbmV3U2hpcCA9IG5ldyBTaGlwKHR5cGUsIHN0YXJ0Q29vcmQsIGlzSG9yaXpvbnRhbCk7IFxyXG4gICAgICAgIHRoaXMuYm9hcmQuYWRkKG5ld1NoaXApO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgeyBQbGF5ZXIgfTsiLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tICcuL2ZhY3Rvcmllcy9QbGF5ZXInOyBcclxuXHJcbmNvbnN0IEdhbWUgPSAoKCkgPT4ge1xyXG4gICAgLy8gQ3JlYXRpbmcgYm90aCBwbGF5ZXJzLiBcclxuICAgIGxldCBwbGF5ZXJPbmUgPSBuZXcgUGxheWVyKCdQbGF5ZXIgMScsIDApOyBcclxuICAgIGxldCBwbGF5ZXJUd28gPSBuZXcgUGxheWVyKCdQbGF5ZXIgMicsIDEpOyBcclxuXHJcbiAgICAvLyBTZWxlY3RpbmcgYWxsIHBsYXllciAmIG9wcG9uZW50IGJvYXJkIGNlbGxzIGZvciByZWZlcmVuY2UuIFxyXG4gICAgY29uc3QgcGxheWVyQ2VsbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ2FtZWJvYXJkLWNlbGwnKTsgXHJcbiAgICBjb25zdCBvcHBvbmVudENlbGxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm9wcG9uZW50LWdhbWVib2FyZC1jZWxsJyk7IFxyXG5cclxuICAgIGNvbnN0IGdhbWVUZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbWUtdGV4dCcpOyBcclxuICAgIGNvbnN0IHN0YXJ0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0YXJ0LWJ0bicpOyBcclxuICAgIGNvbnN0IHJvdGF0ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yb3RhdGUtYnRuJyk7XHJcbiAgICBjb25zdCByZXN0YXJ0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnJlc3RhcnQtYnRuJyk7XHJcbiAgICBjb25zdCBwbGFjZWFibGVTaGlwcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaGlwcy1jb250YWluZXInKTtcclxuXHJcbiAgICBsZXQgcnVubmluZyA9IGZhbHNlOyBcclxuICAgIGxldCBjdXJyZW50UGxheWVyID0gcGxheWVyT25lOyBcclxuXHJcbiAgICBjb25zdCB0b2dnbGVDdXJyUGxheWVyID0gKCkgPT4ge1xyXG4gICAgICAgIGN1cnJlbnRQbGF5ZXIgPSBjdXJyZW50UGxheWVyID09PSBwbGF5ZXJPbmUgPyBwbGF5ZXJUd28gOiBwbGF5ZXJPbmU7IFxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdldEN1cnJQbGF5ZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQbGF5ZXI7IFxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGluaXRpYWxpemVHYW1lID0gKCkgPT4ge1xyXG4gICAgICAgIC8vIFNldCBydW5uaW5nIHZhcmlhYmxlIHRvIHRydWUuIFxyXG4gICAgICAgIHJ1bm5pbmcgPSB0cnVlOyBcclxuXHJcbiAgICAgICAgZ2FtZVRleHQudGV4dENvbnRlbnQgPSBgR2FtZSBzdGFydGVkISBTaW5rIGFsbCB0aGUgb3Bwb25lbnQncyBzaGlwcy5gO1xyXG5cclxuICAgICAgICAvLyBSYW5kb21seSBnZW5lcmF0aW5nIGNvbXB1dGVyJ3Mgc2hpcCBwbGFjZW1lbnRzLiBcclxuICAgICAgICBjb25zdCBzaGlwVHlwZXMgPSB7XHJcbiAgICAgICAgICAgICdjYXJyaWVyJzogNSwgXHJcbiAgICAgICAgICAgICdiYXR0bGVzaGlwJzogNCwgXHJcbiAgICAgICAgICAgICdkZXN0cm95ZXInOiAzLCBcclxuICAgICAgICAgICAgJ3N1Ym1hcmluZSc6IDMsIFxyXG4gICAgICAgICAgICAncGF0cm9sJzogMlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc3Qgc2hpcE5hbWVzID0gWydjYXJyaWVyJywgJ2JhdHRsZXNoaXAnLCAnZGVzdHJveWVyJywgJ3N1Ym1hcmluZScsICdwYXRyb2wnXTsgXHJcbiAgICAgICAgY29uc3QgZGlyZWN0aW9ucyA9IFt0cnVlLCBmYWxzZV07IFxyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICB3aGlsZSAoaSA8IHNoaXBOYW1lcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgLy8gR2VuZXJhdGUgcmFuZG9tIG51bWJlciBiZXR3ZWVuIDAgYW5kIDEgKGluY2x1c2l2ZSk7IFxyXG4gICAgICAgICAgICBjb25zdCByYW5kb21EaXJlY3Rpb24gPSBkaXJlY3Rpb25zW3BhcnNlSW50KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICgxIC0gMCArIDEpICsgMCkpXTsgXHJcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbVggPSBwYXJzZUludChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoOSAtIDAgKyAxKSArIDApKTsgXHJcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbVkgPSBwYXJzZUludChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoOSAtIDAgKyAxKSArIDApKTsgXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBTaGlwOiAke3NoaXBOYW1lc1tpXX0gfCBTaGlwIExlbmd0aDogJHtzaGlwVHlwZXNbc2hpcE5hbWVzW2ldXX0gfCBJbml0aWFsIHJhbmRvbSBzdGFydGluZyBjb29yZDogJHtbcmFuZG9tWCwgcmFuZG9tWV19IHwgRGlyZWN0aW9uOiAke3JhbmRvbURpcmVjdGlvbn1gKTsgXHJcbiAgICAgICAgICAgIC8vIEhvcml6b250YWwgPSB0cnVlIHwgVmVydGljYWwgPSBmYWxzZTsgXHJcbiAgICAgICAgICAgIGlmIChyYW5kb21EaXJlY3Rpb24gPT09IHRydWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyYW5kb21ZICsgc2hpcFR5cGVzW3NoaXBOYW1lc1tpXV0gPCA5KSBjb250aW51ZTsgXHJcbiAgICAgICAgICAgICAgICBsZXQgaXNPY2N1cGllZCA9IGZhbHNlOyBcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgc2hpcFR5cGVzW3NoaXBOYW1lc1tpXV07IGMrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHR5cGVvZihyYW5kb21ZICsgYykpOyBcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyYW5kb21ZICsgYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwbGF5ZXJUd28uYm9hcmQuZ3JpZFtyYW5kb21YXVtyYW5kb21ZICsgY10gfHwgcGxheWVyVHdvLmJvYXJkLmdyaWRbcmFuZG9tWF1bcmFuZG9tWSArIGNdID09PSBcIk9cIikgaXNPY2N1cGllZCA9IHRydWU7IFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGlzT2NjdXBpZWQpIGNvbnRpbnVlOyBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChyYW5kb21YICsgc2hpcFR5cGVzW3NoaXBOYW1lc1tpXV0gPiA5KSBjb250aW51ZTsgXHJcbiAgICAgICAgICAgICAgICBsZXQgaXNPY2N1cGllZCA9IGZhbHNlOyBcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgc2hpcFR5cGVzW3NoaXBOYW1lc1tpXV07IHIrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHR5cGVvZihyYW5kb21YICsgcikpOyBcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyYW5kb21YICsgcik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFwbGF5ZXJUd28uYm9hcmQuZ3JpZFtyYW5kb21YICsgcl1bcmFuZG9tWV0gfHwgcGxheWVyVHdvLmJvYXJkLmdyaWRbcmFuZG9tWCArIHJdW3JhbmRvbVldID09PSBcIk9cIikgaXNPY2N1cGllZCA9IHRydWU7IFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGlzT2NjdXBpZWQpIGNvbnRpbnVlOyBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgU2hpcDogJHtzaGlwTmFtZXNbaV19IHwgRmluYWwgcmFuZG9tIHN0YXJ0aW5nIGNvb3JkOiAke1tyYW5kb21YLCByYW5kb21ZXX1gKTtcclxuICAgICAgICAgICAgcGxheWVyVHdvLnNldFNoaXAoc2hpcE5hbWVzW2ldLCBbcmFuZG9tWCwgcmFuZG9tWV0sIHJhbmRvbURpcmVjdGlvbik7IFxyXG4gICAgICAgICAgICBpKys7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgb3Bwb25lbnRDZWxscy5mb3JFYWNoKGNlbGwgPT4ge1xyXG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spOyBcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGhhbmRsZUNsaWNrKCl7XHJcbiAgICAgICAgLy8gR2V0IHRoZSBjb29yZGluYXRlIFt4LCB5XSBvZiB0aGUgY2VsbCB0aGF0IHdhcyBjbGlja2VkLiBcclxuICAgICAgICBjb25zdCBjZWxsSW5kZXggPSBbcGFyc2VJbnQodGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEteCcpKSwgcGFyc2VJbnQodGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEteScpKV07IFxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGBQbGF5ZXIgMSBjbGlja2VkIGNlbGw6ICR7W2NlbGxJbmRleF19YCk7XHJcbiAgICAgICAgLy8gRmlndXJlIG91dCB3aG8gdGhlIG9wcG9uZW50IGlzIGRlcGVuZGluZyBvbiB0aGUgY3VycmVudFBsYXllci4gXHJcbiAgICAgICAgY29uc3Qgb3Bwb25lbnQgPSBjdXJyZW50UGxheWVyID09PSBwbGF5ZXJPbmUgPyBwbGF5ZXJUd28gOiBwbGF5ZXJPbmU7IFxyXG5cclxuICAgICAgICAvLyBJbnB1dCBWYWxpZGF0aW9uIC0gTWFraW5nIHN1cmUgdGhlIHVzZXIgY2xpY2tzIGEgY2VsbCB0aGF0IGhhc24ndCBiZWVuIGF0dGFja2VkIGJlZm9yZS4gXHJcbiAgICAgICAgaWYgKCFvcHBvbmVudC5ib2FyZC5pc1ZhbGlkTW92ZShjZWxsSW5kZXgpKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBDZWxsICR7Y2VsbEluZGV4fSBoYXMgYWxyZWFkeSBiZWVuIGNsaWNrZWQuIENsaWNrIGFub3RoZXIgY2VsbC5gKTsgXHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBDdXJyZW50IHBsYXllciBpcyBzdGlsbCAke2N1cnJlbnRQbGF5ZXIubmFtZX1gKTsgXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gY3VycmVudFBsYXllcidzIG1vdmUgaXMgdG8gYXR0YWNrIHRoZSBjZWxsIHRoYXQgd2FzIGNsaWNrZWQuIFxyXG4gICAgICAgIGN1cnJlbnRQbGF5ZXIubW92ZShjZWxsSW5kZXgsIG9wcG9uZW50KTsgXHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coY3VycmVudFBsYXllcik7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2cob3Bwb25lbnQpO1xyXG4gICAgICAgIC8vIFVwZGF0ZSB0aGUgb3Bwb25lbnQncyBET00gZ3JpZCB0byBkaXNwbGF5IHRoZSBhdHRhY2suIFxyXG4gICAgICAgIERPTS5yZW5kZXJET01HcmlkKG9wcG9uZW50KTtcclxuICAgICAgICAvLyBDaGVjayBpZiBjdXJyZW50UGxheWVyIHdvbiB0aGUgZ2FtZSB1c2luZyBjaGVja1dpbm5lciBoZWxwZXIgZnVuY3Rpb24uIFxyXG4gICAgICAgIGNoZWNrV2lubmVyKGN1cnJlbnRQbGF5ZXIsIG9wcG9uZW50KTsgXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY29tcHV0ZXJUdXJuID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJhbmRvbU1vdmUgPSBwbGF5ZXJUd28uZ2VuZXJhdGVSYW5kb21BdHRhY2socGxheWVyT25lKTsgXHJcbiAgICAgICAgcGxheWVyVHdvLm1vdmUocmFuZG9tTW92ZSwgcGxheWVyT25lKTsgXHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coYENvbXB1dGVyIGNsaWNrZWQgY2VsbCAke1tyYW5kb21Nb3ZlXX1gKTtcclxuICAgICAgICBET00ucmVuZGVyRE9NR3JpZChwbGF5ZXJPbmUpOyBcclxuXHJcbiAgICAgICAgY2hlY2tXaW5uZXIocGxheWVyVHdvLCBwbGF5ZXJPbmUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoZWNrV2lubmVyID0gKGN1clBsYXllciwgb3Bwb25lbnQpID0+IHtcclxuICAgICAgICBpZiAob3Bwb25lbnQuYm9hcmQuZ2FtZU92ZXIgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgcnVubmluZyA9IGZhbHNlOyBcclxuICAgICAgICAgICAgZ2FtZVRleHQudGV4dENvbnRlbnQgPSBgJHtjdXJQbGF5ZXIubmFtZX0gd2lucyB0aGUgZ2FtZSFgOyBcclxuXHJcbiAgICAgICAgICAgIHBsYXllckNlbGxzLmZvckVhY2goY2VsbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjZWxsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spOyBcclxuICAgICAgICAgICAgfSlcclxuICAgIFxyXG4gICAgICAgICAgICBvcHBvbmVudENlbGxzLmZvckVhY2goY2VsbCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjZWxsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spOyBcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBjdXJyZW50UGxheWVyICYgR2VuZXJhdGUgY29tcHV0ZXIncyBtb3ZlLiBcclxuICAgICAgICAgICAgdG9nZ2xlQ3VyclBsYXllcigpOyBcclxuICAgICAgICAgICAgaWYgKG9wcG9uZW50Lm5hbWUgPT09IFwiUGxheWVyIDJcIikgY29tcHV0ZXJUdXJuKCk7IFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gaGFuZGxlUmVzdGFydCgpIHtcclxuICAgICAgICAvLyBSZWxhb2QgdGhlIHdlYnBhZ2UuIFxyXG4gICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgIC8vIHBsYXllck9uZSA9IG5ldyBQbGF5ZXIoJ1BsYXllciAxJywgMCk7IFxyXG4gICAgICAgIC8vIHBsYXllclR3byA9IG5ldyBQbGF5ZXIoJ1BsYXllciAyJywgMSk7IFxyXG5cclxuICAgICAgICAvLyBsZXQgcnVubmluZyA9IGZhbHNlOyBcclxuICAgICAgICAvLyBsZXQgY3VycmVudFBsYXllciA9IHBsYXllck9uZTtcclxuXHJcbiAgICAgICAgLy8gcmVzdGFydEJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTsgXHJcbiAgICAgICAgLy8gc3RhcnRCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7XHJcbiAgICAgICAgLy8gcm90YXRlQnRuLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xyXG5cclxuICAgICAgICAvLyBnYW1lVGV4dC50ZXh0Q29udGVudCA9ICcnO1xyXG5cclxuICAgICAgICAvLyBwbGFjZWFibGVTaGlwcy5pbm5lckhUTUwgPSBgXHJcbiAgICAgICAgLy8gICAgIDxkaXYgY2xhc3M9XCJzaGlwIHBhdHJvbFwiIGRyYWdnYWJsZT1cInRydWVcIj48L2Rpdj5cclxuICAgICAgICAvLyAgICAgPGRpdiBjbGFzcz1cInNoaXAgc3VibWFyaW5lXCIgZHJhZ2dhYmxlPVwidHJ1ZVwiPjwvZGl2PlxyXG4gICAgICAgIC8vICAgICA8ZGl2IGNsYXNzPVwic2hpcCBkZXN0cm95ZXJcIiBkcmFnZ2FibGU9XCJ0cnVlXCI+PC9kaXY+XHJcbiAgICAgICAgLy8gICAgIDxkaXYgY2xhc3M9XCJzaGlwIGJhdHRsZXNoaXBcIiBkcmFnZ2FibGU9XCJ0cnVlXCI+PC9kaXY+XHJcbiAgICAgICAgLy8gICAgIDxkaXYgY2xhc3M9XCJzaGlwIGNhcnJpZXJcIiBkcmFnZ2FibGU9XCJ0cnVlXCI+PC9kaXY+XHJcbiAgICAgICAgLy8gYDtcclxuXHJcbiAgICAgICAgLy8gRE9NLnJlc2V0RE9NR3JpZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXJ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7IFxyXG4gICAgICAgIGluaXRpYWxpemVHYW1lKCk7IFxyXG4gICAgICAgIHJlc3RhcnRCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7IFxyXG4gICAgICAgIHN0YXJ0QnRuLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xyXG4gICAgfSk7ICBcclxuXHJcbiAgICByZXN0YXJ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlUmVzdGFydCk7IFxyXG5cclxuICAgIHJldHVybiB7IGdldEN1cnJQbGF5ZXIgfTsgXHJcblxyXG59KSgpOyBcclxuXHJcbmNvbnN0IERPTSA9ICgoKSA9PiB7XHJcbiAgICAvLyBSb3RhdGUgdGhlIHNoaXBzIChpbiB0aGUgYmVnaW5uaW5nKS4gXHJcbiAgICBsZXQgaXNIb3Jpem9udGFsID0gdHJ1ZTsgXHJcbiAgICBjb25zdCByb3RhdGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucm90YXRlLWJ0bicpO1xyXG4gICAgcm90YXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7IFxyXG4gICAgICAgIGNvbnN0IGluU2hpcENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zaGlwcy1jb250YWluZXIgLnNoaXAnKTsgXHJcbiAgICAgICAgaW5TaGlwQ29udGFpbmVyLmZvckVhY2goc2hpcCA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNoaXBOYW1lID0gc2hpcC5jbGFzc05hbWUuc3BsaXQoJyAnKVsxXTsgXHJcbiAgICAgICAgICAgIHNoaXAuY2xhc3NMaXN0LnRvZ2dsZShgJHtzaGlwTmFtZX0tdmVydGljYWxgKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlzSG9yaXpvbnRhbCA9PT0gZmFsc2UgPyBpc0hvcml6b250YWwgPSB0cnVlIDogaXNIb3Jpem9udGFsID0gZmFsc2U7IFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gTW92ZSBhcm91bmQgdXNlciBzaGlwcyAoaW4gdGhlIGJlZ2lubmluZykuIFxyXG4gICAgY29uc3Qgc2hpcHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2hpcCcpO1xyXG4gICAgc2hpcHMuZm9yRWFjaChzaGlwID0+IHNoaXAuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZHJhZ1N0YXJ0KSlcclxuXHJcbiAgICBsZXQgZHJhZ2dlZFNoaXA7IFxyXG5cclxuICAgIGZ1bmN0aW9uIGRyYWdTdGFydCgpIHtcclxuICAgICAgICBkcmFnZ2VkU2hpcCA9IHRoaXM7IFxyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGRyYWdnZWRTaGlwKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcmFnT3ZlcihlKSB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOyBcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcmFnRW50ZXIoZSkge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTsgXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ0xlYXZlKCkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdkcmFnIGxlYXZlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZHJhZ0VuZCgpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZygnZHJhZyBlbmQnKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkcm9wKCkge1xyXG4gICAgICAgIGNvbnN0IHNoaXBUeXBlcyA9IHtcclxuICAgICAgICAgICAgJ2NhcnJpZXInOiA1LCBcclxuICAgICAgICAgICAgJ2JhdHRsZXNoaXAnOiA0LCBcclxuICAgICAgICAgICAgJ2Rlc3Ryb3llcic6IDMsIFxyXG4gICAgICAgICAgICAnc3VibWFyaW5lJzogMywgXHJcbiAgICAgICAgICAgICdwYXRyb2wnOiAyXHJcbiAgICAgICAgfTtcclxuICAgICAgICBjb25zdCBkcmFnZ2VkU2hpcFR5cGUgPSBkcmFnZ2VkU2hpcC5jbGFzc0xpc3RbMV07XHJcbiAgICAgICAgY29uc3QgZHJhZ2dlZFNoaXBMZW5ndGggPSBzaGlwVHlwZXNbZHJhZ2dlZFNoaXBUeXBlXTtcclxuICAgICAgICBjb25zdCBwbGFjZWRJbmRleFBvcyA9IFtwYXJzZUludCh0aGlzLmRhdGFzZXQueCksIHBhcnNlSW50KHRoaXMuZGF0YXNldC55KV1cclxuXHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coYFNoaXAgVHlwZTogJHtkcmFnZ2VkU2hpcFR5cGV9IHwgU2hpcCBMZW5ndGg6ICR7ZHJhZ2dlZFNoaXBMZW5ndGh9IHwgUGxhY2VkIEluZGV4OiAke3BsYWNlZEluZGV4UG9zfWApO1xyXG5cclxuICAgICAgICBpZiAoaXNIb3Jpem9udGFsKSB7XHJcbiAgICAgICAgICAgIGlmIChwbGFjZWRJbmRleFBvc1sxXSArIChkcmFnZ2VkU2hpcExlbmd0aCAtIDEpIDw9IDkpIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZHJhZ2dlZFNoaXBMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoaXBDZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtY29vcmQ9J1ske3BsYWNlZEluZGV4UG9zWzBdfSwke3BsYWNlZEluZGV4UG9zWzFdICsgaX1dJ11gKTtcclxuICAgICAgICAgICAgICAgICAgICBzaGlwQ2VsbC5jbGFzc0xpc3QuYWRkKCdzaGlwJyk7IFxyXG4gICAgICAgICAgICAgICAgfSBcclxuICAgICAgICAgICAgICAgIGRyYWdnZWRTaGlwLnJlbW92ZSgpOyBcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMuYXBwZW5kKGRyYWdnZWRTaGlwKTsgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChwbGFjZWRJbmRleFBvc1swXSArIChkcmFnZ2VkU2hpcExlbmd0aCAtIDEpIDw9IDkpIHtcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZHJhZ2dlZFNoaXBMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNoaXBDZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtY29vcmQ9J1ske3BsYWNlZEluZGV4UG9zWzBdICsgaX0sJHtwbGFjZWRJbmRleFBvc1sxXX1dJ11gKTtcclxuICAgICAgICAgICAgICAgICAgICBzaGlwQ2VsbC5jbGFzc0xpc3QuYWRkKCdzaGlwJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkcmFnZ2VkU2hpcC5yZW1vdmUoKTsgXHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmFwcGVuZChkcmFnZ2VkU2hpcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgY29uc3QgY3VyUGxheWVyID0gR2FtZS5nZXRDdXJyUGxheWVyKCk7IFxyXG4gICAgICAgIGN1clBsYXllci5zZXRTaGlwKGRyYWdnZWRTaGlwVHlwZSwgcGxhY2VkSW5kZXhQb3MsIGlzSG9yaXpvbnRhbCk7IFxyXG5cclxuICAgICAgICBpZiAoYWxsU2hpcHNQbGFjZWQoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBzdGFydEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdGFydC1idG4nKTsgXHJcbiAgICAgICAgICAgIHN0YXJ0QnRuLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICByb3RhdGVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGFsbFNoaXBzUGxhY2VkID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2hpcHMtY29udGFpbmVyIC5zaGlwJykubGVuZ3RoID09PSAwID8gdHJ1ZSA6IGZhbHNlOyBcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1c2VyU3F1YXJlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy51c2VyLWJvYXJkIC5nYW1lYm9hcmQgLmdhbWVib2FyZC1yb3cgLmdhbWVib2FyZC1jZWxsJyk7XHJcbiAgICB1c2VyU3F1YXJlcy5mb3JFYWNoKHNxdWFyZSA9PiBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ3N0YXJ0JywgZHJhZ1N0YXJ0KSlcclxuICAgIHVzZXJTcXVhcmVzLmZvckVhY2goc3F1YXJlID0+IHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIGRyYWdPdmVyKSlcclxuICAgIHVzZXJTcXVhcmVzLmZvckVhY2goc3F1YXJlID0+IHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW50ZXInLCBkcmFnRW50ZXIpKVxyXG4gICAgdXNlclNxdWFyZXMuZm9yRWFjaChzcXVhcmUgPT4gc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdsZWF2ZScsIGRyYWdMZWF2ZSkpXHJcbiAgICB1c2VyU3F1YXJlcy5mb3JFYWNoKHNxdWFyZSA9PiBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGRyb3ApKVxyXG4gICAgdXNlclNxdWFyZXMuZm9yRWFjaChzcXVhcmUgPT4gc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCBkcmFnRW5kKSlcclxuICAgIFxyXG4gICAgY29uc3QgcmVuZGVyRE9NR3JpZCA9IChwbGF5ZXIpID0+IHtcclxuICAgICAgICBjb25zdCBwbGF5ZXJHcmlkID0gcGxheWVyLmJvYXJkLmdyaWQ7IFxyXG4gICAgICAgIGNvbnN0IHBsYXllckluZGV4ID0gcGxheWVyLm5hbWUgPT09IFwiUGxheWVyIDFcIiA/IDAgOiAxO1xyXG4gICAgICAgIGNvbnN0IG1pc3NlZFNob3RzID0gcGxheWVyLmJvYXJkLm1pc3NlZFNob3RzOyBcclxuICAgICAgICBcclxuICAgICAgICAvLyBMb2FkaW5nIHRoZSBhdHRhY2tzIHRoYXQgaGl0IG9uZSBvZiB0aGUgb3Bwb25lbnQncyBzaGlwLW9jY3VwaWVkIGNlbGxzIChnb29kIGF0dGFjaykuIFxyXG4gICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgMTA7IHIrKykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IDEwOyBjKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGBbZGF0YS1jb29yZD0nWyR7cn0sJHtjfV0nXWApOyBcclxuICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJHcmlkW3JdW2NdID09PSBcIlhcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxbcGxheWVySW5kZXhdLmNsYXNzTGlzdC5hZGQoJ2dvb2QtYXR0YWNrJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gTG9hZGluZyB0aGUgYXR0YWNrcyB0aGF0IGhpdCB0aGUgd2F0ZXIgb24gdGhlIG9wcG9uZW50J3MgZ3JpZCAoYmFkIGF0dGFjaykuIFxyXG4gICAgICAgIGZvciAoY29uc3QgbWlzc2VkIG9mIG1pc3NlZFNob3RzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IFtyLCBjXSA9IG1pc3NlZDsgXHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGBbZGF0YS1jb29yZD0nWyR7cn0sJHtjfV0nXWApO1xyXG4gICAgICAgICAgICBjZWxsW3BsYXllckluZGV4XS5jbGFzc0xpc3QuYWRkKCdtaXNzZWQtYXR0YWNrJyk7IFxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVzZXRET01HcmlkID0gKCkgPT4ge1xyXG4gICAgICAgIHVzZXJTcXVhcmVzLmZvckVhY2goY2VsbCA9PiB7XHJcbiAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LnJlbW92ZSgnc2hpcCcpOyBcclxuICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QucmVtb3ZlKCdtaXNzZWQtYXR0YWNrJyk7IFxyXG4gICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5yZW1vdmUoJ2dvb2QtYXR0YWNrJyk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4geyByZW5kZXJET01HcmlkLCByZXNldERPTUdyaWQgfTtcclxufSkoKTsgXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbIkdhbWVib2FyZCIsImNvbnN0cnVjdG9yIiwidGhpcyIsImdyaWQiLCJjcmVhdGUiLCJzaGlwcyIsImdhbWVPdmVyIiwibWlzc2VkU2hvdHMiLCJhZGQiLCJzaGlwIiwicHVzaCIsImNvb3JkIiwiY29vcmRzIiwicmVjZWl2ZUF0dGFjayIsImNvb3JkaW5hdGUiLCJldmVyeSIsImVsZW1lbnQiLCJpbmRleCIsImhpdCIsImNoZWNrR2FtZU92ZXIiLCJzdW5rQ291bnQiLCJoaXRDb3VudCIsImxlbmd0aCIsImJvYXJkIiwiciIsInJvdyIsImMiLCJpc1ZhbGlkTW92ZSIsImluY2x1ZGVzIiwiU2hpcCIsInR5cGUiLCJzdGFydENvb3JkIiwiaXNIb3Jpem9udGFsIiwic3Vua1N0YXR1cyIsInBvcHVsYXRlQ29vcmRzIiwiaXNTdW5rIiwic2hpcE9mZnNldCIsImN1clgiLCJjdXJZIiwiaSIsIm5ld1giLCJuZXdZIiwiUGxheWVyIiwibmFtZSIsImdlbmVyYXRlUmFuZG9tQXR0YWNrIiwib3Bwb25lbnQiLCJyYW5kb21YIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicmFuZG9tWSIsIm1vdmUiLCJlbmVteSIsInNldFNoaXAiLCJuZXdTaGlwIiwiR2FtZSIsInBsYXllck9uZSIsInBsYXllclR3byIsInBsYXllckNlbGxzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwib3Bwb25lbnRDZWxscyIsImdhbWVUZXh0IiwicXVlcnlTZWxlY3RvciIsInN0YXJ0QnRuIiwicmVzdGFydEJ0biIsInJ1bm5pbmciLCJjdXJyZW50UGxheWVyIiwiaGFuZGxlQ2xpY2siLCJjZWxsSW5kZXgiLCJwYXJzZUludCIsImdldEF0dHJpYnV0ZSIsIkRPTSIsInJlbmRlckRPTUdyaWQiLCJjaGVja1dpbm5lciIsImN1clBsYXllciIsInRleHRDb250ZW50IiwiZm9yRWFjaCIsImNlbGwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwicmFuZG9tTW92ZSIsImNvbXB1dGVyVHVybiIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJzaGlwVHlwZXMiLCJzaGlwTmFtZXMiLCJkaXJlY3Rpb25zIiwicmFuZG9tRGlyZWN0aW9uIiwiaXNPY2N1cGllZCIsImluaXRpYWxpemVHYW1lIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwibG9jYXRpb24iLCJyZWxvYWQiLCJnZXRDdXJyUGxheWVyIiwicm90YXRlQnRuIiwiZHJhZ2dlZFNoaXAiLCJkcmFnU3RhcnQiLCJkcmFnT3ZlciIsImRyYWdFbnRlciIsImRyYWdMZWF2ZSIsImRyYWdFbmQiLCJkcm9wIiwiZHJhZ2dlZFNoaXBUeXBlIiwiZHJhZ2dlZFNoaXBMZW5ndGgiLCJwbGFjZWRJbmRleFBvcyIsImRhdGFzZXQiLCJ4IiwieSIsInJlbW92ZSIsImFsbFNoaXBzUGxhY2VkIiwic2hpcE5hbWUiLCJjbGFzc05hbWUiLCJzcGxpdCIsInVzZXJTcXVhcmVzIiwic3F1YXJlIiwicGxheWVyIiwicGxheWVyR3JpZCIsInBsYXllckluZGV4IiwibWlzc2VkIiwicmVzZXRET01HcmlkIl0sInNvdXJjZVJvb3QiOiIifQ==